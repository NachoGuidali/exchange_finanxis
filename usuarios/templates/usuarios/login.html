{% extends "base.html" %}
{% load static %}
{% block title %}Ingresar — Finanxis{% endblock %}

{% block body_class %}min-h-screen flex flex-col bg-gray-50 text-gray-800{% endblock %}

{% block content %}
<section class="max-w-6xl mx-auto px-4 py-12">
  <div class="grid gap-10 lg:grid-cols-12 items-center">
    <!-- Col: Form -->
    <div class="lg:col-span-6">
      <div class="rounded-xl border card p-6 sm:p-7 shadow-card">
        <h1 class="text-2xl sm:text-3xl font-extrabold mb-6">Ingresa a tu cuenta</h1>

        {% if messages %}
          <div class="mb-4 space-y-2">
            {% for message in messages %}
              <div class="rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-sm">{{ message }}</div>
            {% endfor %}
          </div>
        {% endif %}

        <!-- errores no de campo -->
        {% if form.non_field_errors %}
          <div class="mb-4 rounded-lg border border-red-400/30 bg-red-500/10 px-3 py-2 text-sm text-red-300">
            {{ form.non_field_errors }}
          </div>
        {% endif %}

        <form method="post" action="{% url 'login' %}?next={% url 'dashboard' %}" class="space-y-4">
          {% csrf_token %}

          {# Usuario / email #}
          <label class="block">
            <span class="text-sm font-medium text-gray-800">Usuario o email</span>
            {{ form.username.errors }}
            <input
              type="text"
              name="{{ form.username.html_name }}"
              value="{{ form.username.value|default:'' }}"
              autocomplete="username"
              required
              class="mt-1 w-full rounded-xl border border-black/10 bg-white px-3 py-2.5 shadow-sm outline-none focus:ring-2 focus:ring-primary"
              placeholder="tu@correo.com">
          </label>

          {# Password + ojo #}
          <label class="block">
            <span class="text-sm font-medium text-gray-800">Contraseña</span>
            {{ form.password.errors }}
            <div class="mt-1 relative">
              <input
                id="ff-pass"
                type="password"
                name="{{ form.password.html_name }}"
                autocomplete="current-password"
                required
                class="w-full rounded-xl border border-black/10 bg-white px-3 py-2.5 pr-10 shadow-sm outline-none focus:ring-2 focus:ring-primary"
                placeholder="••••••••">
              <button type="button" id="ff-toggle"
                      class="absolute inset-y-0 right-0 grid w-10 place-items-center text-gray-500 hover:text-gray-700"
                      aria-label="Mostrar contraseña">
                <!-- ojo -->
                <svg id="ff-eye-open" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                    d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7S2 12 2 12z"/>
                  <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.5" />
                </svg>
                <svg id="ff-eye-closed" xmlns="http://www.w3.org/2000/svg" class="hidden h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M3 3l18 18M10.6 10.6A3 3 0 0113.4 13.4M6.2 6.6C3.9 8 2 12 2 12s3.5 7 10 7c2 0 3.7-.4 5.1-1.1M17.8 7.4C20.1 9 22 12 22 12s-1.1 2.2-3 3.9"/>
                </svg>
              </button>
            </div>
            <div class="mt-2">
              <a href="{% url 'password_reset' %}" class="text-sm text-gray-600 hover:text-gray-800">¿Te olvidaste tu contraseña?</a>
            </div>
          </label>

          <button class="mt-2 inline-flex h-11 w-full items-center justify-center rounded-xl bg-primary px-4 text-base font-semibold text-white shadow-soft hover:opacity-90">
            Ingresar
          </button>

          <p class="text-sm text-gray-700">
            ¿No tenés cuenta?
            <a class="text-primary font-semibold hover:opacity-90" href="{% url 'registro' %}">Crear cuenta &gt;</a>
          </p>
        </form>
      </div>
    </div>

    <!-- Col: Ilustración / logo -->
    <div class="lg:col-span-6 hidden md:flex items-center justify-center">
      <div class="relative">
        <div class="absolute -inset-8 -z-10 rounded-[2rem] blur-2xl"
             style="background: radial-gradient(60% 40% at 50% 0%, rgba(255,17,41,.2), transparent)"></div>
        <div class="rounded-[2rem] border border-black/10 bg-white p-8 shadow-card">
          <img src="{% static 'img/logo.png' %}" alt="Finanxis" class="h-20 w-auto drop-shadow" />
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  (function(){
    const input = document.getElementById('ff-pass');
    const btn   = document.getElementById('ff-toggle');
    const openI = document.getElementById('ff-eye-open');
    const closeI= document.getElementById('ff-eye-closed');
    if(!input || !btn) return;
    btn.addEventListener('click', ()=>{
      const show = input.type === 'password';
      input.type = show ? 'text' : 'password';
      openI.classList.toggle('hidden', show);
      closeI.classList.toggle('hidden', !show);
    });
  })();
</script>
{% endblock %}
